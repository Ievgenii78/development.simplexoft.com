"undefined"==typeof data8&&(window.data8=function(){}),"undefined"==typeof data8.prototype.callQueue&&(data8.prototype.callQueue=new Array),data8.webservicesDomain="https://webservices.data-8.co.uk","undefined"==typeof data8.predictiveaddressui&&(data8.predictiveaddressui=function(e,t){this.options=t,this.document=e.ownerDocument||e.document,this.settingValue=!1,this.options.ajaxKey||this.options.jwt||(this.options.ajaxKey=data8.apiKey);var s=this;s.loadCountries(function(){s.validate(),s.createElements(e),s.selectDefaultCountry(),s.attachKeyPressEvent(),s.disableAutocomplete()})},data8.predictiveaddressui.prototype.show=function(){},data8.predictiveaddressui.prototype.destroy=function(){var e=textbox.parentElement;this.removeClass(e,"data8-pa-container"),e.removeChild(this.elements.container),this.removeEventListener(this.elements.textbox,this.events.textboxFocus),this.removeEventListener(this.document,this.events.documentFocus)},data8.predictiveaddressui.prototype._supportedCountries=null,data8.predictiveaddressui.prototype.loadCountries=function(e){return"undefined"==typeof this.options.includeNYB&&(this.options.includeNYB=!1),"undefined"==typeof this.options.includeMR&&(this.options.includeMR=!1),"undefined"==typeof this.options.applicationName&&(this.options.applicationName="predictiveaddress.js"),"undefined"==typeof this.options.initialCountry&&(this.options.initialCountry="auto"),"auto"===this.options.initialCountry&&"undefined"!=typeof this.options.allowedCountries&&null!==this.options.allowedCountries&&1===this.options.allowedCountries.length&&(this.options.initialCountry=this.options.allowedCountries[0]),"undefined"===this.options.includeLocation&&(this.options.includeLocation=!1),"undefined"===this.options.includeAdminArea&&(this.options.includeAdminArea=!1),"undefined"===this.options.includeCountry&&(this.options.includeCountry=!1),data8.predictiveaddressui.prototype._supportedCountries?void e():void this.ajaxAsyncRequest(data8.webservicesDomain+"/PredictiveAddress/GetSupportedCountriesAdvanced.json",JSON.stringify({options:{IncludeNYB:this.options.includeNYB,IncludeMR:this.options.includeMR,GetCurrentCountry:!0,ApplicationName:this.options.applicationName}}),function(t){if(data8.predictiveaddressui.prototype._supportedCountries=[],!t.Status.Success)return console.log(t.Status.ErrorMessage),void e();for(var s=0;s<t.Countries.length;s++)data8.predictiveaddressui.prototype._supportedCountries.push({iso2:t.Countries[s].ISO2,name:t.Countries[s].Name});t.CurrentCountry&&(data8.predictiveaddressui.prototype._currentCountry=t.CurrentCountry.ISO2),e()},function(e){"object"==typeof e&&(e=JSON.stringify(e)),console.log("GetSupportedCountriesAdvanced Error: "+e)})},data8.predictiveaddressui.prototype.getSupportedCountries=function(){var e=data8.predictiveaddressui.prototype._supportedCountries;if(this.options.allowedCountries||this.options.barredCountries){for(var t=[],s=0;s<e.length;s++)this.options.allowedCountries&&!(this.options.allowedCountries.indexOf(e[s].iso2)>-1)||this.options.barredCountries&&this.options.barredCountries.indexOf(e[s].iso2)!==-1||t.push(e[s]);e=t}return e},data8.predictiveaddressui.prototype.validate=function(){var e=this.getSupportedCountries();"undefined"==typeof this.options.fallbackCountry&&(this.options.fallbackCountry="GB");for(var t=!1,s=0;s<e.length;s++)if(e[s].iso2===this.options.fallbackCountry){t=!0;break}t||(this.options.fallbackCountry=e[0].iso2),"undefined"==typeof this.options.countryFieldFormat&&(this.options.countryFieldFormat="ISO2"),"undefined"==typeof this.options.includeUdprn&&(this.options.includeUdprn=!1),"undefined"==typeof this.options.includeUprn&&(this.options.includeUprn=!1),"undefined"==typeof this.options.placeholder&&(this.options.placeholder="Type an address"),"undefined"==typeof this.options.minDelay&&(this.options.minDelay=100),"undefined"==typeof this.options.preferredLanguage&&(this.options.preferredLanguage="en"),this.options.session="",this.options.selecteditem=null},data8.predictiveaddressui.prototype.createElements=function(e){var t=this.closest(e,".modal");t&&t.setAttribute("data-backdrop","static");var s=e.parentElement;this.addClass(s,"data8-pa-container"),e.setAttribute("aria-autocomplete","list");var i=this.document.createElement("div");this.addClass(i,"data8-pa-countrylistcontainer"),this.addClass(e,"data8-predictiveaddress"),e.placeholder||(e.placeholder=this.options.placeholder);var o=this.document.createElement("div");this.addClass(o,"data8-pa-countrycurrent");var n=this.document.createElement("img");o.appendChild(n);var a=this.document.createElement("div");this.addClass(a,"data8-pa-countryselector"),a.appendChild(o);var r=this.document.createElement("span");r.appendChild(this.document.createTextNode("Change Country")),a.appendChild(r),i.appendChild(a);var d=this.document.createElement("div");i.appendChild(d),this.addClass(d,"data8-pa-autocomplete");var l=this.document.createElement("div");this.addClass(l,"data8-pa-autocompletetitle"),d.appendChild(l);var p=this.document.createTextNode("");l.appendChild(p);var u=this.document.createElement("div");this.addClass(u,"data8-pa-countrydropdowncontainer"),this.addClass(u,"form-group"),u.style="display:none;";var c=this.document.createElement("div");this.addClass(c,"input-group");var m=this.document.createElement("input");m.setAttribute("type","text"),m.setAttribute("autocomplete","off"),m.setAttribute("placeholder","Search..."),m.setAttribute("tabindex","-1"),this.addClass(m,"data8-pa-countrysearch"),this.addClass(m,"form-control");var h=this.document.createElement("div");this.addClass(h,"data8-pa-countrylist"),c.appendChild(m),c.appendChild(h),u.appendChild(c),i.appendChild(u),this.document.body.appendChild(i);var f=this.document.createElement("div");this.addClass(f,"data8-pa-aria"),f.setAttribute("role","status"),f.setAttribute("aria-live","assertive"),f.setAttribute("aria-relevant","additions"),this.document.body.appendChild(f),this.elements={textbox:e,modal:t,container:i,countryList:h,countryContainer:u,countrySearch:m,countryCurrent:o,flag:n,countrySelector:a,autocomplete:d,autocompleteTitle:l,autocompleteTitleText:p,aria:f},this.populateCountries();var v=this,y=this.addEventListener(e,"focus",function(){v.addClass(s,"data8-pa-focused"),v.getSupportedCountries().length>1&&v.addClass(a,"data8-pa-visible"),v.positionContainerBelowTextbox()}),C=this.addEventListener(a,"click",function(){v.elements.modal&&v.elements.modal.setAttribute("tabindex",null),"block"===u.style.display?v.removeClass(u,"data8-pa-visible"):(v.addClass(u,"data8-pa-visible"),m.focus()),"block"===h.style.display?v.removeClass(h,"data8-pa-visible"):(v.addClass(h,"data8-pa-visible"),v.elements.countrySearch.value="",v.onCountrySearchInput(v.elements.countrySearch.value)),"block"===m.style.display?v.removeClass(m,"data8-pa-visible"):(v.addClass(m,"data8-pa-visible"),m.focus())}),g=this.addEventListener(this.document,"focus",function(e){return e.target===v.elements.textbox?(v.removeClass(d,"data8-pa-visible"),v.removeClass(h,"data8-pa-visible"),v.removeClass(u,"data8-pa-visible"),v.removeClass(m,"data8-pa-visible"),void(v.elements.modal&&v.elements.modal.setAttribute("tabindex","-1"))):void(v.closest(this.document.activeElement,".data8-pa-countrylistcontainer")||(v.removeClass(s,"data8-pa-focused"),v.removeClass(a,"data8-pa-visible"),v.removeClass(h,"data8-pa-visible"),v.removeClass(u,"data8-pa-visible"),v.removeClass(m,"data8-pa-visible"),v.removeClass(d,"data8-pa-visible"),v.elements.modal&&v.elements.modal.setAttribute("tabindex","-1")))},!0),b=this.addEventListener(this.document,"click",function(e){if("BODY"===e.target.tagName&&this.document.activeElement===v.elements.textbox)v.addClass(s,"data8-pa-focused"),v.addClass(a,"data8-pa-visible");else{if(e.target===v.elements.textbox)return v.removeClass(d,"data8-pa-visible"),v.removeClass(h,"data8-pa-visible"),v.removeClass(u,"data8-pa-visible"),v.removeClass(m,"data8-pa-visible"),void(v.elements.modal&&v.elements.modal.setAttribute("tabindex","-1"));v.closest(e.target,".data8-pa-countrylistcontainer")||(v.removeClass(s,"data8-pa-focused"),v.removeClass(a,"data8-pa-visible"),v.removeClass(h,"data8-pa-visible"),v.removeClass(u,"data8-pa-visible"),v.removeClass(m,"data8-pa-visible"),v.removeClass(d,"data8-pa-visible"),v.elements.modal&&v.elements.modal.setAttribute("tabindex","-1"))}},!0);this.events={textboxFocus:y,countrySelectorClick:C,documentFocus:g,documentClick:b},document.activeElement===e&&y({target:e})},data8.predictiveaddressui.prototype.closest=function(e,t){if(Element.prototype.closest)return e.closest(t);if(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.matches){var s=e;do{if(s.matches(t))return s;s=s.parentElement||s.parentNode}while(null!==s&&1===s.nodeType);return null}return null},data8.predictiveaddressui.prototype.startsWith=function(e,t){return String.prototype.startsWith?e.startsWith(t):e.substr(0,t.length)===t},data8.predictiveaddressui.prototype.readText=function(e){e.innerText?e=e.innerText:e.textContent&&(e=e.textContent),this.elements.ariaLastText&&(this.elements.ariaLastText.style.display="none");var t=this.document.createElement("div"),s=this.document.createTextNode(e);t.appendChild(s),this.elements.aria.appendChild(t),this.elements.ariaLastText=t},data8.predictiveaddressui.prototype.addEventListener=function(e,t,s,i){var o=function(e){e||(e=window.event),e.target||(e.target=e.srcElement),s(e)};return e.addEventListener?e.addEventListener(t,o,i):e.attachEvent("on"+t,o),o},data8.predictiveaddressui.prototype.removeEventListener=function(e,t,s){e.removeEventListener?e.removeEventListener(t,s):e.detachEvent("on"+t,s)},data8.predictiveaddressui.prototype.addClass=function(e,t){if(e.classList)return void(e.classList.contains(t)||e.classList.add(t));var s=e.className.split(/\s+/),i=s.indexOf(t);i<0&&(e.className+=" "+t)},data8.predictiveaddressui.prototype.removeClass=function(e,t){if(e.classList)return void(e.classList.contains(t)&&e.classList.remove(t));var s=e.className.split(/\s+/),i=s.indexOf(t);i<0||(s.splice(i,1),e.className=s.join(" "))},data8.predictiveaddressui.prototype.hasClass=function(e,t){if(e.classList)return e.classList.contains(t);var s=e.className.split(/\s+/),i=s.indexOf(t);return i>=0},data8.predictiveaddressui.prototype.getOffset=function(e){if(e.getBoundingClientRect){var t=e.getBoundingClientRect(),s=void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,i=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{left:t.left+s,top:t.top+i}}var o={left:e.offsetLeft,top:e.offsetTop};if(e.offsetParent){var n=this.getOffset(e.offsetParent);o.left+=n.left,o.top+=n.top,o.parent=n}return o},data8.predictiveaddressui.prototype.positionContainerBelowTextbox=function(){var e=this.getOffset(this.elements.textbox);this.elements.container.style.left=""+e.left+"px",this.elements.container.style.top=""+(e.top+this.elements.textbox.clientHeight)+"px",this.elements.container.style.minWidth=""+this.elements.textbox.offsetWidth+"px";var t=this.elements.container.getElementsByClassName("data8-pa-autocomplete")[0],s=this.elements.container.getElementsByClassName("data8-pa-countrylist")[0],i=450;if(this.elements.textbox.offsetWidth>i)t.style.minWidth=""+this.elements.textbox.offsetWidth+"px",s.style.minWidth=""+this.elements.textbox.offsetWidth+"px";else{var o=document.body.clientWidth-e.left;o<i?(t.style.minWidth=""+o+"px",s.style.minWidth=""+o+"px"):(t.style.minWidth=""+i+"px",s.style.minWidth=""+i+"px")}},data8.predictiveaddressui.prototype.getFlagPath=function(e){return data8.webservicesDomain+"/content/flags-iso/shiny/24/blank.gif"},data8.predictiveaddressui.prototype.getFlagClass=function(e){return"d8-flag d8-flag-"+e.toLowerCase()},data8.predictiveaddressui.prototype.getCountry=function(){switch(this.options.countryFieldFormat.toLowerCase()){case"iso2":return this.options.country;case"name":for(var e=this.getSupportedCountries(),t=0;t<e.length;t++)if(e[t].iso2===this.options.country)return e[t].name;return""}return this.options.country},data8.predictiveaddressui.prototype.isSupportedCountry=function(e){for(var t=this.getSupportedCountries(),s=0;s<t.length;s++)if(e===t[s].iso2||e===t[s].name)return t[s].iso2;return null},data8.predictiveaddressui.prototype.setCountry=function(e){var t=this,s=t.getSupportedCountries(),i=t.options.fallbackCountry?t.options.fallbackCountry:s[0].iso2;"auto"===e&&(e=data8.predictiveaddressui.prototype._currentCountry||i),e=this.isSupportedCountry(e),null===e&&(e=s[s.length-1].iso2),t.options.country=e,t.elements.flag.src=t.getFlagPath(t.options.country),t.elements.flag.className=t.getFlagClass(t.options.country),e===s[s.length-1].iso2?this.options.disabled=!0:this.options.disabled=!1},data8.predictiveaddressui.prototype.populateCountries=function(){var e=this.elements.countryList,t=this,s=this.document.createElement("ul"),i=this.getSupportedCountries();this.options.selectedcountryitem=null;for(var o=0;o<i.length;o++){var n=i[o],a=this.document.createElement("li"),r=this.document.createElement("img"),d=this.document.createElement("span"),l=this.document.createTextNode(n.name);d.appendChild(l),r.src=this.getFlagPath(n.iso2),r.className=this.getFlagClass(n.iso2),a.setAttribute("data-countrycode",n.iso2),a.setAttribute("data-displayname",n.name),this.addClass(a,"data8-pa-listitem"),a.appendChild(r),a.appendChild(d),a.onclick=function(){t.setCountry(this.getAttribute("data-countrycode")),t.removeClass(e,"data8-pa-visible"),t.elements.textbox.focus(),t.options.selectedcountryitem=null,t.elements.countrySearch.value=""},s.appendChild(a),0===o&&(this.options.firstcountryitem=a)}e.appendChild(s)},data8.predictiveaddressui.prototype.getElement=function(e){if(this.isElement(e))return e;if(this.isjQuery(e))return e[0];var t=this.document.getElementById(e);if(!t){var s=this.document.getElementsByName(e);s&&s.length&&(t=s[s.length-1])}return t},data8.predictiveaddressui.prototype.isElement=function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},data8.predictiveaddressui.prototype.isjQuery=function(e){return"object"==typeof jQuery&&e instanceof jQuery},data8.predictiveaddressui.prototype.toProperCase=function(e){return e?e.toLowerCase().replace(/^(.)|\s(.)/g,function(e){return e.toUpperCase()}):null},data8.predictiveaddressui.prototype.getTelephoneNumber=function(){var e="";if("undefined"!=typeof this.options.fields&&this.options.fields.length>0)for(var t=0;t<this.options.fields.length;t++)if("telephonenumber"===this.options.fields[t].field){var s=this.getElement(this.options.fields[t].element);s&&(e=s.value);break}return e},data8.predictiveaddressui.prototype.getLineCount=function(){if("undefined"==typeof this.options.lineCount&&(this.options.lineCount=6,"undefined"!=typeof this.options.fields)){this.options.lineCount=0;for(var e=0;e<this.options.fields.length;e++)0===this.options.fields[e].field.indexOf("line")&&this.options.lineCount++;this.usesFixedBuilding()&&this.options.lineCount++,this.usesFixedTownCounty()&&(this.options.lineCount+=2)}return this.options.lineCount},data8.predictiveaddressui.prototype.usesFixedTownCounty=function(){if("undefined"==typeof this.options.fixTownCounty&&(this.options.fixTownCounty=!1),"undefined"!=typeof this.options.fields)for(var e=0;e<this.options.fields.length;e++)if("town"===this.options.fields[e].field||"county"===this.options.fields[e].field){this.options.fixTownCounty=!0;break}return this.options.fixTownCounty},data8.predictiveaddressui.prototype.usesFixedPostcode=function(){if("undefined"==typeof this.options.fixPostcode&&(this.options.fixPostcode=!1),"undefined"!=typeof this.options.fields)for(var e=0;e<this.options.fields.length;e++)if("postcode"===this.options.fields[e].field){this.options.fixPostcode=!0;break}return this.options.fixPostcode},data8.predictiveaddressui.prototype.usesOrganisation=function(){if("undefined"==typeof this.options.separateOrganisation&&(this.options.separateOrganisation=!1),"undefined"!=typeof this.options.fields)for(var e=0;e<this.options.fields.length;e++)if("organisation"===this.options.fields[e].field){this.options.separateOrganisation=!0;break}return this.options.separateOrganisation},data8.predictiveaddressui.prototype.maxLineLength=function(){return"undefined"==typeof this.options.maxLineLength&&(this.options.maxLineLength=255),this.options.maxLineLength},data8.predictiveaddressui.prototype.unwantedPunctuation=function(){return"undefined"==typeof this.options.unwantedPunctuation&&(this.options.unwantedPunctuation=""),this.options.unwantedPunctuation},data8.predictiveaddressui.prototype.usesFixedBuilding=function(){if("undefined"==typeof this.options.fixBuilding&&(this.options.fixBuilding=!1),"undefined"!=typeof this.options.fields)for(var e=0;e<this.options.fields.length;e++)if("building"===this.options.fields[e].field){this.options.fixBuilding=!0;break}return this.options.fixBuilding},data8.predictiveaddressui.prototype.selectDefaultCountry=function(){var e=!1,t=this,s=null;if(this.options.fields)for(var i=0;i<this.options.fields.length;i++)if("country"===this.options.fields[i].field){s=this.getElement(this.options.fields[i].element);break}if(s){var o=s.value;if(o){if(!this.isSupportedCountry(o)&&"SELECT"===s.tagName){var n=this.getSelectText(s);this.isSupportedCountry(n)&&(o=n)}this.setCountry(o),e=!0}this.addEventListener(s,"change",function(){var e=s.value;if(!t.isSupportedCountry(e)&&"SELECT"===s.tagName){var i=t.getSelectText(s);t.isSupportedCountry(i)&&(e=i)}t.setCountry(e)})}e||this.setCountry(this.options.initialCountry)},data8.predictiveaddressui.prototype.getSelectText=function(e){var t=e.selectedIndex;return t===-1?null:e.options[t].text},data8.predictiveaddressui.prototype.disableAutocomplete=function(){this.elements.textbox.autocomplete="nope"},data8.predictiveaddressui.prototype.attachKeyPressEvent=function(){var e=this;this.addEventListener(this.elements.textbox,"input",function(){if(!e.settingValue){if(e.options.minDelay<=0)return void e.onSearchInput();e.options.searchTimer&&clearTimeout(e.options.searchTimer),e.options.searchTimer=setTimeout(function(){e.onSearchInput()},e.options.minDelay)}}),this.addEventListener(this.elements.countrySearch,"input",function(t){e.settingValue||e.onCountrySearchInput(t.target.value)}),this.addEventListener(this.document,"keydown",function(t){if(t.target===e.elements.textbox||t.target===e.elements.countrySearch)switch(t.keyCode){case 13:if(e.options.selecteditem&&e.elements.autocomplete.classList.contains("data8-pa-visible"))if(e.options.selecteditem.classList.contains("data8-pa-autocompletetitle"))e.options.selecteditem&&(e.removeClass(e.options.selecteditem,"data8-pa-focused"),e.options.selecteditem.setAttribute("aria-selected",!1)),e.removeClass(e.elements.autocomplete,"data8-pa-visible"),e.getSupportedCountries().length>1&&e.addClass(e.elements.countrySelector,"data8-pa-visible"),e.options.selecteditem=null;else{var s=e.options.selecteditem.getAttribute("data-container"),i=e.options.selecteditem.getAttribute("data-id");s?e.itemDrilledDown(i):e.itemClicked(i)}else e.options.selectedcountryitem&&(e.setCountry(e.options.selectedcountryitem.getAttribute("data-countrycode")),e.removeClass(e.elements.countryList,"data8-pa-visible"),e.removeClass(e.elements.countrySearch,"data8-pa-visible"),e.elements.textbox.focus(),e.options.selectedcountryitem=null,e.elements.countrySearch.value="");break;case 40:if(e.options.items)e.hasClass(e.elements.autocomplete,"data8-pa-visible")||(e.addClass(e.elements.autocomplete,"data8-pa-visible"),e.removeClass(e.elements.countrySelector,"data8-pa-visible")),null===e.options.selecteditem?(e.options.selecteditem=e.options.firstitem,e.options.selecteditem.offsetParent.scrollTop=0):e.options.selecteditem.nextSibling&&(e.removeClass(e.options.selecteditem,"data8-pa-focused"),e.options.selecteditem.setAttribute("aria-selected","false"),e.options.selecteditem=e.options.selecteditem.nextSibling,e.options.selecteditem.offsetParent.scrollTop+e.options.selecteditem.offsetParent.offsetHeight<e.options.selecteditem.offsetTop+e.options.selecteditem.offsetHeight&&(e.options.selecteditem.offsetParent.scrollTop=e.options.selecteditem.offsetTop+e.options.selecteditem.offsetHeight-e.options.selecteditem.offsetParent.offsetHeight)),e.options.selecteditem&&(e.addClass(e.options.selecteditem,"data8-pa-focused"),e.readText(e.options.selecteditem));else{if(t.stopImmediatePropagation(),t.preventDefault(),e.elements.modal&&e.elements.modal.setAttribute("tabindex","null"),e.hasClass(e.elements.countryContainer,"data8-pa-visible")||e.addClass(e.elements.countryContainer,"data8-pa-visible"),e.hasClass(e.elements.countrySearch,"data8-pa-visible")||e.addClass(e.elements.countrySearch,"data8-pa-visible"),e.hasClass(e.elements.countryList,"data8-pa-visible")){if(e.options.selectedcountryitem&&e.options.selectedcountryitem.nextSibling){for(var o=null,n=e.options.selectedcountryitem.nextSibling;!o&&("none"!==n.style.display&&(o=n),n.nextSibling);)n=n.nextSibling;o&&(e.removeClass(e.options.selectedcountryitem,"data8-pa-focused"),e.options.selectedcountryitem.setAttribute("aria-selected","false"),e.options.selectedcountryitem=o,e.options.selectedcountryitem.offsetParent.scrollTop+e.options.selectedcountryitem.offsetParent.offsetHeight<e.options.selectedcountryitem.offsetTop+e.options.selectedcountryitem.offsetHeight&&(e.options.selectedcountryitem.offsetParent.scrollTop=e.options.selectedcountryitem.offsetTop+e.options.selectedcountryitem.offsetHeight-e.options.selectedcountryitem.offsetParent.offsetHeight))}}else e.addClass(e.elements.countryList,"data8-pa-visible"),e.elements.countrySearch.value="",e.onCountrySearchInput(e.elements.countrySearch.value),e.elements.countrySearch.focus();e.options.selectedcountryitem&&(e.addClass(e.options.selectedcountryitem,"data8-pa-focused"),e.readText(e.options.selectedcountryitem))}break;case 38:if(e.hasClass(e.elements.autocomplete,"data8-pa-visible")&&null!==e.options.selecteditem&&e.options.selecteditem.previousSibling)e.removeClass(e.options.selecteditem,"data8-pa-focused"),e.options.selecteditem.setAttribute("aria-selected","false"),e.options.selecteditem=e.options.selecteditem.previousSibling,e.addClass(e.options.selecteditem,"data8-pa-focused"),e.readText(e.options.selecteditem),e.options.selecteditem.offsetParent&&e.options.selecteditem.offsetParent.scrollTop>e.options.selecteditem.offsetTop&&(e.options.selecteditem.offsetParent.scrollTop=e.options.selecteditem.offsetTop);else if(e.hasClass(e.elements.countryList,"data8-pa-visible")&&e.hasClass(e.elements.countryContainer,"data8-pa-visible")&&null!==e.options.selectedcountryitem&&e.options.selectedcountryitem.previousSibling&&(t.stopImmediatePropagation(),t.preventDefault(),e.options.selectedcountryitem.previousSibling)){for(var a=null,r=e.options.selectedcountryitem.previousSibling;!a&&("none"!==r.style.display&&(a=r),r.previousSibling);)r=r.previousSibling;a&&(e.removeClass(e.options.selectedcountryitem,"data8-pa-focused"),e.options.selectedcountryitem.setAttribute("aria-selected","false"),e.options.selectedcountryitem=a,e.addClass(e.options.selectedcountryitem,"data8-pa-focused"),e.readText(e.options.selectedcountryitem),e.options.selectedcountryitem.offsetParent.scrollTop>e.options.selectedcountryitem.offsetTop&&(e.options.selectedcountryitem.offsetParent.scrollTop=e.options.selectedcountryitem.offsetTop))}break;case 27:e.hasClass(e.elements.autocomplete,"data8-pa-visible")&&(e.options.selecteditem&&(e.removeClass(e.options.selecteditem,"data8-pa-focused"),e.options.selecteditem.setAttribute("aria-selected","false")),e.removeClass(e.elements.autocomplete,"data8-pa-visible"),e.getSupportedCountries().length>1&&e.addClass(e.elements.countrySelector,"data8-pa-visible"),e.options.selecteditem=null),e.hasClass(e.elements.countryList,"data8-pa-visible")&&(e.options.selectedcountryitem&&(e.removeClass(e.options.selectedcountryitem,"data8-pa-focused"),e.options.selectedcountryitem.setAttribute("aria-selected","false")),e.removeClass(e.elements.countryList,"data8-pa-visible"),e.removeClass(e.elements.countrySearch,"data8-pa-visible"),e.removeClass(e.elements.countryContainer,"data8-pa-visible"),e.options.selectedcountryitem=null,e.elements.modal&&e.elements.modal.setAttribute("tabindex","-1"),t.stopImmediatePropagation(),t.preventDefault(),e.elements.textbox.focus());break;case 9:e.hasClass(e.elements.countryList,"data8-pa-visible")&&(e.removeClass(e.options.selectedcountryitem,"data8-pa-focused"),e.elements.textbox.focus()),e.hasClass(e.elements.countrySelector,"data8-pa-visible")&&e.removeClass(e.elements.countrySelector,"data8-pa-visible")}})},data8.predictiveaddressui.prototype.onCountrySearchInput=function(e){var t=this.document.getElementsByClassName("data8-pa-listitem"),s=[];if(this.options.firstcountryitem=null,e){if(e=e.toLowerCase(),0===s.length)for(var i=0;i<t.length;i++){t[i].style.display="none",this.removeClass(t[i],"data8-pa-focused");var o=t[i].getAttribute("data-displayname").toLowerCase();if(o&&this.startsWith(o,e))t[i].style.display="",s.push(t[i]),1===s.length&&(this.options.firstcountryitem=t[i]);else if(2===e.length){var n=t[i].getAttribute("data-countrycode");n&&this.startsWith(n.toLowerCase(),e)?(t[i].style.display="",s.push(t[i]),1===s.length&&(this.options.firstcountryitem=t[i])):"united kingdom"===o&&this.startsWith(e,"uk")&&(t[i].style.display="",s.push(t[i]),1===s.length&&(this.options.firstcountryitem=t[i]))}}if(0===s.length)for(var i=0;i<t.length;i++){t[i].style.display="none",this.removeClass(t[i],"data8-pa-focused");var n=t[i].getAttribute("data-countrycode");n&&this.startsWith(n.toLowerCase(),e)&&(t[i].style.display="",0===s.length&&(this.options.firstcountryitem=t[i]),s.push(t[i]))}if(0===s.length)for(var i=0;i<t.length;i++){t[i].style.display="none",this.removeClass(t[i],"data8-pa-focused");var o=t[i].getAttribute("data-displayname");o&&o.toLowerCase().includes(e)&&(t[i].style.display="",0===s.length&&(this.options.firstcountryitem=t[i]),s.push(t[i]))}}else for(var t=this.document.getElementsByClassName("data8-pa-listitem"),i=0;i<t.length;i++)t[i].style.display="",this.removeClass(t[i],"data8-pa-focused"),0===i&&(this.options.firstcountryitem=t[i]);this.options.selectedcountryitem=this.options.firstcountryitem,this.options.selectedcountryitem&&(this.addClass(this.options.selectedcountryitem,"data8-pa-focused"),this.options.selectedcountryitem.offsetParent&&(this.options.selectedcountryitem.offsetParent.scrollTop=0))},data8.predictiveaddressui.prototype.onSearchInput=function(){var e=this;e.options.searchTimer=null;var t=e.elements.textbox.value;if(!t)return e.removeClass(e.elements.autocomplete,"data8-pa-visible"),e.getSupportedCountries().length>1&&e.addClass(e.elements.countrySelector,"data8-pa-visible"),void(this.options.items=null);e.hasClass(e.elements.countryList,"data8-pa-visible")&&(e.options.selectedcountryitem&&(e.removeClass(e.options.selectedcountryitem,"data8-pa-focused"),e.options.selectedcountryitem.setAttribute("aria-selected","false")),e.removeClass(e.elements.countryList,"data8-pa-visible"),e.options.selectedcountryitem=null),e.options.sequence?e.options.sequence++:e.options.sequence=1;var s=e.options.sequence;e.addClass(e.elements.textbox,"data8-pa-loading"),e.options.selecteditem=null,this.ajaxAsyncRequest(data8.webservicesDomain+"/PredictiveAddress/Search.json",JSON.stringify({country:e.options.country,search:e.elements.textbox.value,telephoneNumber:e.getTelephoneNumber(),session:e.options.session,options:{PreferredLanguage:e.options.preferredLanguage,IncludeNYB:e.options.includeNYB,IncludeMR:e.options.includeMR,ApplicationName:e.options.applicationName}}),function(t){e.removeClass(e.elements.textbox,"data8-pa-loading"),e.options.sequence===s&&e.showResults(t)})},data8.predictiveaddressui.prototype.showResults=function(e){var t=this;if(this.options.items=null,e.Status.Success&&e.SessionID&&(this.options.session=e.SessionID),this.options.showResults){var s=this.options.showResults(this,e);if("undefined"!=typeof s&&s)return}for(this.options.firstitem=null,this.options.selecteditem=null;this.elements.autocompleteTitle.nextSibling;)this.elements.autocomplete.removeChild(this.elements.autocompleteTitle.nextSibling);if(e.Status.Success){if(this.options.items=e.Results,e.Count>e.Results.length){var i=""+e.Count;i+=1===e.Count?" result":e.Count>=100?"+ results. Enter more information to refine your results":" results",this.removeClass(this.elements.autocompleteTitle,"data8-pa-error"),this.addClass(this.elements.autocompleteTitle,"data8-pa-title"),this.addClass(this.elements.autocompleteTitle,"data8-pa-visible"),this.elements.autocompleteTitleText.nodeValue=i}else this.removeClass(this.elements.autocompleteTitle,"data8-pa-visible");for(var o=0;o<e.Results.length;o++){var n=e.Results[o],a=this.document.createElement("div");this.addClass(a,"data8-pa-autocompleteitem"),a.setAttribute("data-id",n.value);var r=this.document.createElement("span");if(this.addClass(r,"data8-pa-autocompleteitemtext"),r.appendChild(this.document.createTextNode(n.label)),a.appendChild(r),this.elements.autocomplete.appendChild(a),n.container){a.setAttribute("data-container","true"),this.addClass(a,"data8-pa-autocompleteitemwithcontainer");var d=this.document.createElement("span");this.addClass(d,"data8-pa-autocompleteitemcontainer"),d.appendChild(this.document.createTextNode(n.items+" items")),a.appendChild(d),this.addEventListener(a,"click",function(e){for(var s=e.target;s&&!s.getAttribute("data-id");)s=s.parentElement;s&&t.itemDrilledDown(s.getAttribute("data-id"))})}else this.addEventListener(a,"click",function(e){for(var s=e.target;s&&!s.getAttribute("data-id");)s=s.parentElement;s&&t.itemClicked(s.getAttribute("data-id"))});0===o&&(this.options.firstitem=a)}}else this.addClass(this.elements.autocompleteTitle,"data8-pa-error"),this.addClass(this.elements.autocompleteTitle,"data8-pa-visible"),this.elements.autocompleteTitleText.nodeValue=e.Status.ErrorMessage;this.elements.autocomplete.scrollTop=0,this.addClass(this.elements.autocomplete,"data8-pa-visible"),this.removeClass(this.elements.countrySelector,"data8-pa-visible")},data8.predictiveaddressui.prototype.itemDrilledDown=function(e){var t=this;this.ajaxAsyncRequest(data8.webservicesDomain+"/PredictiveAddress/DrillDown.json",JSON.stringify({country:this.options.country,id:e,options:{PreferredLanguage:this.options.preferredLanguage,IncludeNYB:this.options.includeNYB,IncludeMR:this.options.includeMR,ApplicationName:this.options.applicationName}}),function(e){t.showResults(e)})},data8.predictiveaddressui.prototype.itemClicked=function(e){var t=this,s={MaxLineLength:this.maxLineLength(),MaxLines:this.getLineCount(),FixTownCounty:this.usesFixedTownCounty(),FixPostcode:this.usesFixedPostcode(),FixBuilding:this.usesFixedBuilding(),UnwantedPunctuation:this.unwantedPunctuation(),Formatter:this.usesOrganisation()?"NoOrganisationFormatter":"DefaultFormatter",IncludeUDPRN:this.options.includeUdprn,IncludeUPRN:this.options.includeUprn,PreferredLanguage:this.options.preferredLanguage,IncludeNYB:this.options.includeNYB,IncludeMR:this.options.includeMR,IncludeLocation:this.options.includeLocation,IncludeAdminArea:this.options.includeAdminArea,IncludeCountry:this.options.includeCountry,ApplicationName:this.options.applicationName},i=this.options.customFormatterOptions;if(i){var o=Object.keys(i);o.forEach(function(e){s[e]=i[e]})}this.ajaxAsyncRequest(data8.webservicesDomain+"/PredictiveAddress/Retrieve.json",JSON.stringify({country:this.options.country,id:e,options:s}),function(e){t.selectAddress(e.Result),t.options.selectAddress&&t.options.selectAddress(e.Result,t.getCountry())})},data8.predictiveaddressui.prototype.selectAddress=function(e){
this.removeClass(this.elements.autocomplete,"data8-pa-visible");var t=!1;if(this.options.fields)for(var s=0;s<this.options.fields.length;s++){var i;if(i=this.options.fields[s].jQuerySelector?window.jQuery(this.options.fields[s].jQuerySelector).get(0):this.getElement(this.options.fields[s].element)){t=t||i===this.elements.textbox;var o;switch(this.options.fields[s].field.toLowerCase()){case"organisation":o=this.toProperCase(e.RawAddress.Organisation);break;case"building":o=e.Address.Lines[0];break;case"line1":o=e.Address.Lines[0+(this.usesFixedBuilding()?1:0)];break;case"line2":o=e.Address.Lines[1+(this.usesFixedBuilding()?1:0)];break;case"line3":o=e.Address.Lines[2+(this.usesFixedBuilding()?1:0)];break;case"line4":o=e.Address.Lines[3+(this.usesFixedBuilding()?1:0)];break;case"line5":o=e.Address.Lines[4+(this.usesFixedBuilding()?1:0)];break;case"line6":o=e.Address.Lines[5+(this.usesFixedBuilding()?1:0)];break;case"town":o=e.Address.Lines[e.Address.Lines.length-3];break;case"county":o=e.Address.Lines[e.Address.Lines.length-2],o||"SELECT"!==i.tagName||(o=e.RawAddress.PostalCounty,o||(o=e.RawAddress.TraditionalCounty),o||(o=e.RawAddress.AdministrativeCounty));break;case"postcode":o=e.Address.Lines[e.Address.Lines.length-1];break;case"country":o=this.getCountry();break;default:o=i.value}this.setValue(i,o)}}if(!t){for(var n="",a=0;a<e.Address.Lines.length;a++){var r=e.Address.Lines[a];r&&(n&&(n+=", "),n+=r)}this.setValue(this.elements.textbox,n)}},data8.predictiveaddressui.prototype.setValue=function(e,t){if(this.settingValue=!0,"INPUT"===e.tagName){var s=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set;s.call(e,t)}else if("SELECT"===e.tagName){var i=Object.getOwnPropertyDescriptor(window.HTMLSelectElement.prototype,"value").set;i.call(e,t)}else e.value=t;if(e.value!==t&&"SELECT"===e.tagName)for(var o=0;o<e.options.length;o++)if(e.options[o].text===t){var n=Object.getOwnPropertyDescriptor(window.HTMLSelectElement.prototype,"selectedIndex").set;n.call(e,o);break}if(document.createEventObject)e.fireEvent("onchange"),e.fireEvent("oninput");else{var a=new Event("change",{bubbles:!0});e.dispatchEvent(a);var r=new Event("input",{bubbles:!0});e.dispatchEvent(r)}this.settingValue=!1},data8.predictiveaddressui.prototype.ajaxAsyncRequest=function(e,t,s){var i,o=this;i=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");var n=!1,a=e.split("/")[4].replace(".json","");this.options.ajaxKey?e+="?key="+this.options.ajaxKey:this.options.jwt?n=!0:console.log("Either an AjaxKey or JWT Token are required for Data8 Ajax Validation."),i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status){var e=JSON.parse(i.responseText);s(e),o.options.processedRequest&&o.options.processedRequest(a,e)}else if(o.options.errorHandler)429===i.status?o.options.errorHandler(i.status):o.options.errorHandler(JSON.parse(i.responseText));else{var t=JSON.parse(i.responseText);console.log(t.Status.ErrorMessage)}},i.open("POST",e,!0),n&&i.setRequestHeader("Authorization","Bearer "+this.options.jwt),i.send(t)}),"undefined"==typeof window.jQuery&&"undefined"==typeof $?(data8.jQueryLite=function(e){"#"===e.substring(0,1)&&(e=e.substring(1)),this.textbox=document.getElementById(e)},data8.jQueryLite.prototype.predictiveaddressui=function(e){return new data8.predictiveaddressui(this.textbox,e)},$=function(e){return new data8.jQueryLite(e)}):window.jQuery.fn.predictiveaddressui=function(e){return this.each(function(){new data8.predictiveaddressui(this,e)})};